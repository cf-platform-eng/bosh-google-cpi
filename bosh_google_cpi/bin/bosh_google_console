#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-
# Copyright (c) 2014 Pivotal Software, Inc. All Rights Reserved.

$LOAD_PATH.unshift(File.expand_path('../../lib', __FILE__))

require 'bosh_google_cpi'
require 'irb'
require 'irb/completion'
require 'ostruct'
require 'optparse'

config_file = nil
opts_parser = OptionParser.new do |opts|
  opts.on('-c', '--config FILE') { |file| config_file = file }
end
opts_parser.parse!

unless config_file
  puts opts_parser
  exit(1)
end

@config = Psych.load_file(config_file)

##
# Helpers for the BOSH Google Compute Engine CPI console
module ConsoleHelpers
  def cpi
    @cpi ||= Bosh::Google::Cloud.new(@config)
  end

  def compute
    cpi.compute_api
  end

  def storage
    cpi.storage_api
  end

  def registry
    cpi.registry
  end
end

Bosh::Clouds::Config.configure(OpenStruct.new(logger: Logger.new(STDOUT)))

puts '=> Welcome to BOSH Google Compute Engine CPI console'
puts 'You can use "cpi" to access Bosh::Google::Cloud methods'
puts 'You can use "compute" to access Fog::Compute::Google methods'
puts 'You can use "storage" to access Fog::Storage::Google methods'

include ConsoleHelpers
IRB.start
